<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Controle de Consumo - √Ågua e Energia</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    color: #0d47a1;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #0d47a1;
  }
  form {
    display: grid;
    gap: 10px;
    max-width: 400px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  input, textarea, button {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #90caf9;
    font-size: 16px;
  }
  button {
    background: #0d47a1;
    color: white;
    border: none;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {
    background: #1976d2;
  }
  .painel {
    max-width: 600px;
    margin: 20px auto;
    background: white;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  .painel h2 {
    text-align: center;
  }
  .painel table {
    width: 100%;
    border-collapse: collapse;
  }
  .painel th, .painel td {
    padding: 8px;
    border: 1px solid #90caf9;
    text-align: center;
  }
  .info {
    text-align: center;
    margin-top: 10px;
    font-style: italic;
  }
</style>
</head>
<body>
<h1>üíß‚ö° Controle de Consumo Di√°rio</h1>

<form id="formConsumo">
  <label>Data:</label>
  <input type="date" id="data" required />

  <label>Consumo de √Ågua (Litros):</label>
  <input type="number" id="agua" required />

  <label>Consumo de Energia (kWh):</label>
  <input type="number" id="energia" required />

  <label>Observa√ß√µes:</label>
  <textarea id="obs" rows="2"></textarea>

  <button type="submit">Salvar Dados</button>
</form>

<div class="painel">
  <h2>üìÖ Consumo do Dia Anterior</h2>
  <table id="tabelaConsumo">
    <thead>
      <tr><th>Data</th><th>√Ågua (L)</th><th>Energia (kWh)</th><th>Observa√ß√µes</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<p class="info" id="mensagem"></p>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyNCs-rBo-pLWJg-OG9GMobz-dm0h7a6dTbFzMjK77vG-Ifs4w85h9Edb2xKKMGH4m0sw/exec";

// --- FUN√á√ÉO: Enviar dados para o Google Sheets ---
document.getElementById("formConsumo").addEventListener("submit", async (e) => {
  e.preventDefault();

  const dados = {
    entry: {
      date: document.getElementById("data").value,
      water: parseFloat(document.getElementById("agua").value),
      energy: parseFloat(document.getElementById("energia").value),
      notes: document.getElementById("obs").value,
      createdAt: new Date().toISOString()
    },
    sheetName: "Consumo"
  };

  try {
    const resp = await fetch(SCRIPT_URL, {
      method: "POST",
      mode: "cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(dados)
    });

    const text = await resp.text();
    console.log("Resposta do servidor:", text);

    if (text.includes("OK")) {
      document.getElementById("mensagem").textContent = "‚úÖ Dados salvos com sucesso!";
      document.getElementById("formConsumo").reset();
      carregarConsumoAnterior(); // Atualiza a tabela
    } else {
      document.getElementById("mensagem").textContent = "‚ö†Ô∏è Erro inesperado ao salvar.";
    }

  } catch (error) {
    console.error("Erro ao enviar:", error);
    document.getElementById("mensagem").textContent = "‚ùå Erro ao salvar dados.";
  }
});

// --- FUN√á√ÉO: Buscar o √∫ltimo registro (dia anterior) ---
async function carregarConsumoAnterior() {
  try {
    const resp = await fetch(SCRIPT_URL + "?sheetName=Consumo", { method: "GET" });
    const data = await resp.json();

    if (!Array.isArray(data) || data.length === 0) {
      document.getElementById("mensagem").textContent = "Nenhum registro encontrado.";
      return;
    }

    // Ordena pela data (√∫ltimo registro)
    const ultimo = data.sort((a, b) => new Date(b.Data) - new Date(a.Data))[0];

    const tbody = document.querySelector("#tabelaConsumo tbody");
    tbody.innerHTML = `
      <tr>
        <td>${ultimo.Data || "-"}</td>
        <td>${ultimo["√Ågua (L)"] || "-"}</td>
        <td>${ultimo["Energia (kWh)"] || "-"}</td>
        <td>${ultimo.Observa√ß√µes || "-"}</td>
      </tr>
    `;
  } catch (error) {
    console.error("Erro ao carregar dados:", error);
    document.getElementById("mensagem").textContent = "Erro ao buscar dados do dia anterior.";
  }
}

// Carregar automaticamente ao abrir
window.addEventListener("load", carregarConsumoAnterior);
</script>
</body>
</html>
